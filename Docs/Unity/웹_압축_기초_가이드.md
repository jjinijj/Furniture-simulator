# 🗜️ 웹 압축 기초 가이드 (15분)

**작성일:** 2025년 12월 19일  
**대상:** 프론트엔드 개발자  
**목적:** 압축 기본 개념과 Unity WebGL 압축 이해

---

## 📋 목차

1. [압축이 왜 필요한가?](#압축이-왜-필요한가)
2. [압축 알고리즘 비교](#압축-알고리즘-비교)
3. [Unity WebGL 압축](#unity-webgl-압축)
4. [서버 설정 기본](#서버-설정-기본)
5. [실전 팁](#실전-팁)
6. [면접 대비](#면접-대비)

---

## 🎯 압축이 왜 필요한가?

### 문제 상황

**웹 애플리케이션 로딩:**
```
JavaScript 번들: 5MB
이미지들: 10MB
Unity WebGL: 20MB
──────────────────
Total: 35MB

4G 연결 (평균 10Mbps):
→ 로딩 시간: 28초
→ 사용자: "너무 느려! 나간다!" 😡
```

### 해결: 압축!

**압축 적용 후:**
```
JavaScript: 5MB → 1.5MB (70% 감소)
이미지: 10MB → 8MB (20% 감소)
Unity WebGL: 20MB → 6MB (70% 감소)
──────────────────────────────────
Total: 35MB → 15.5MB (56% 감소)

로딩 시간: 28초 → 12초
→ 사용자: "빠르다! 좋아!" 😊
```

---

## 🔧 압축 알고리즘 비교

### 주요 3가지

| 알고리즘 | 출시 | 압축률 | 속도 | 브라우저 지원 | Unity 지원 |
|---------|------|--------|------|--------------|-----------|
| **Disabled** | - | 0% | 최고 | 100% | ✅ |
| **Gzip** | 1992 | 70% | 빠름 | 100% | ✅ |
| **Brotli** | 2015 | 75-80% | 보통 | 95%+ | ✅ |

---

### 1. Disabled (압축 없음)

**사용 시기:**
```
✅ 개발 중 (디버깅 쉬움)
✅ 로컬 테스트
❌ 프로덕션 (절대 안 됨!)
```

**장점:**
```
✅ 빌드 빠름
✅ 디버깅 쉬움
```

**단점:**
```
❌ 파일 크기 큼
❌ 로딩 느림
❌ 대역폭 낭비
```

---

### 2. Gzip

**가장 많이 사용!**

**특징:**
```
출시: 1992년 (32년 전!)
알고리즘: DEFLATE (LZ77 + Huffman)
확장자: .gz, .unityweb (Unity)
Content-Encoding: gzip
```

**압축 과정:**
```
1. 반복되는 패턴 찾기 (LZ77)
   "hello hello hello"
   → "hello" + "앞의 hello 반복 x2"

2. 빈도 기반 재인코딩 (Huffman)
   자주 나오는 글자 → 짧은 코드
   안 나오는 글자 → 긴 코드
```

**압축률 예시:**
```
텍스트 (HTML, JS, CSS): 70-80%
이미지 (이미 압축됨): 5-10%
Unity WebGL: 60-70%
```

**장점:**
```
✅ 모든 브라우저 지원
✅ 빠른 압축/해제
✅ 안정적
✅ 서버 설정 쉬움
```

**단점:**
```
⚠️ Brotli보다 압축률 낮음
```

**사용 추천:**
```
✅ 일반 웹사이트
✅ Unity WebGL (기본 선택)
✅ 프로덕션 배포
```

---

### 3. Brotli

**구글이 만든 최신 압축!**

**특징:**
```
출시: 2015년 (구글)
알고리즘: LZ77 변형 + Huffman + Context modeling
확장자: .br
Content-Encoding: br
```

**Gzip과의 차이:**
```
Gzip:   기본 패턴 매칭
Brotli: 더 큰 사전 + 문맥 인식
        → 더 똑똑한 압축
```

**압축률 비교:**
```
10MB 원본 기준:

Gzip:   3.0MB (70% 감소)
Brotli: 2.5MB (75% 감소)

→ Brotli가 15-20% 더 작음!
```

**장점:**
```
✅ 압축률 최고
✅ 특히 텍스트/코드에 강함
✅ 최신 브라우저 모두 지원
```

**단점:**
```
❌ 압축 시간 느림 (Gzip의 2-3배)
❌ 서버 CPU 사용 약간 높음
❌ 오래된 브라우저 미지원 (IE)
```

**사용 추천:**
```
✅ 정적 파일 (미리 압축)
✅ CDN 사용 시
✅ 최신 프로젝트
⚠️ Unity WebGL은 Gzip 추천 (호환성)
```

---

## 🎮 Unity WebGL 압축

### Player Settings

**위치:**
```
File → Build Settings → Player Settings
→ Publishing Settings
→ Compression Format
```

**옵션:**

| 설정 | 파일명 | 크기 | 속도 | 추천 |
|------|--------|------|------|------|
| **Disabled** | `.data` | 20MB | 빠름 | 개발용 |
| **Gzip** | `.data.unityweb` | 6MB | 보통 | **프로덕션** ⭐ |
| **Brotli** | `.data.br` | 5MB | 느림 | CDN용 |

---

### Decompression Fallback

**설정:**
```
Publishing Settings
→ Decompression Fallback: ✅ 체크 (추천!)
```

**역할:**
```
서버 설정이 없어도 작동하게!
```

**동작 과정:**

**체크 O (권장):**
```
1. 브라우저: 파일 요청
2. 서버: Content-Encoding 없이 전송
3. Unity Loader: "헤더 없네? 내가 직접 풀게!"
4. JavaScript로 Gzip 압축 해제
5. Unity 실행 ✅

→ 서버 설정 몰라도 작동!
→ 약간 느림 (1-2초 추가)
```

**체크 X (위험):**
```
1. 브라우저: 파일 요청
2. 서버: Content-Encoding 없이 전송
3. Unity Loader: "헤더 없는데 압축 파일?"
4. 에러 발생! ❌

→ 서버 설정 필수!
→ 설정 안 하면 안 돌아감!
```

**결론:**
```
개발/테스트: ✅ 필수 체크
프로덕션: 서버 설정 있으면 선택, 없으면 체크
```

---

### 파일명 규칙

**Gzip:**
```
FurnitureSimulator.data.unityweb
FurnitureSimulator.framework.js.unityweb
FurnitureSimulator.wasm.unityweb
FurnitureSimulator.loader.js (압축 안 됨)
```

**Brotli:**
```
FurnitureSimulator.data.br
FurnitureSimulator.framework.js.br
FurnitureSimulator.wasm.br
```

**Disabled:**
```
FurnitureSimulator.data
FurnitureSimulator.framework.js
FurnitureSimulator.wasm
```

---

## 🌐 서버 설정 기본

### 왜 서버 설정이 필요한가?

**HTTP 헤더 전송:**
```
Content-Encoding: gzip
```

**이 헤더가 있으면:**
```
브라우저: "아, 압축 파일이구나! 자동으로 풀게!"
→ 빠름, CPU 낮음
```

**이 헤더가 없으면:**
```
Unity Loader: "JavaScript로 직접 풀게..."
→ 느림, CPU 높음
```

---

### Python 서버 (개발용)

**현재 사용 중:**
```bash
python3 -m http.server 8000
```

**문제:**
```
❌ Content-Encoding 헤더 안 보냄
→ Decompression Fallback 필요
→ 약간 느림
```

**해결 (선택):**
```python
# custom_server.py
from http.server import SimpleHTTPRequestHandler, HTTPServer

class CustomHandler(SimpleHTTPRequestHandler):
    def end_headers(self):
        if self.path.endswith('.unityweb'):
            self.send_header('Content-Encoding', 'gzip')
        super().end_headers()

HTTPServer(('', 8000), CustomHandler).serve_forever()
```

**사용:**
```bash
python3 custom_server.py
```

---

### Vercel (배포용)

**자동 압축!**

**설정 파일 (vercel.json):**
```json
{
  "headers": [
    {
      "source": "/(.*).unityweb",
      "headers": [
        {
          "key": "Content-Encoding",
          "value": "gzip"
        }
      ]
    }
  ]
}
```

**장점:**
```
✅ 자동 설정
✅ 빠른 속도
✅ CDN 제공
✅ 무료
```

---

### Nginx (고급)

```nginx
# nginx.conf
http {
    gzip on;
    gzip_types text/plain application/javascript text/css application/json;
    
    location ~* \.unityweb$ {
        add_header Content-Encoding gzip;
        gzip off;  # 이미 압축됨
    }
}
```

---

## 💡 실전 팁

### 1. 개발 vs 프로덕션

**개발 (로컬):**
```
Compression: Disabled
→ 빌드 빠름 (30초)
→ 디버깅 쉬움
→ 파일 크기 상관없음
```

**프로덕션 (배포):**
```
Compression: Gzip
→ 빌드 느림 (1-2분)
→ 파일 작음 (70% 감소)
→ 로딩 빠름
```

---

### 2. 빌드 크기 줄이기

**압축 외 방법:**

**Code Optimization:**
```
Player Settings → Other Settings
→ Code Optimization: Size

Speed: 빠르지만 큼
Size: 느리지만 작음 (30% 추가 감소)
```

**Stripping Level:**
```
Managed Stripping Level: High
→ 안 쓰는 코드 제거
→ 크기 감소
```

**텍스처 압축:**
```
Texture Compression: DXT/ASTC
→ 이미지 크기 감소
→ 품질 약간 저하
```

---

### 3. 로딩 속도 개선

**프로그레시브 로딩:**
```html
<script>
createUnityInstance(canvas, config, (progress) => {
    // 0.0 ~ 1.0
    progressBar.style.width = (progress * 100) + '%';
    
    if (progress < 0.5) {
        statusText.textContent = '데이터 로딩 중...';
    } else if (progress < 0.9) {
        statusText.textContent = '초기화 중...';
    } else {
        statusText.textContent = '거의 다 됐어요!';
    }
});
</script>
```

**스트리밍 에셋:**
```
작은 로더 → 빠른 시작
→ 백그라운드에서 나머지 로드
```

---

### 4. 캐싱 활용

**Data Caching 설정:**
```
Publishing Settings
→ Data Caching: ✅ 체크

결과:
첫 방문: 12초
재방문: 2초! (캐시 사용)
```

**브라우저 캐시:**
```
Cache-Control: max-age=31536000
→ 1년간 캐시
→ 재방문 시 다운로드 안 함
```

---

## 📊 성능 비교

### 실제 측정 (10MB 프로젝트)

| 설정 | 파일 크기 | 로딩 (4G) | 로딩 (WiFi) | 빌드 시간 |
|------|----------|-----------|-------------|----------|
| **Disabled** | 10.0 MB | 8초 | 2초 | 30초 |
| **Gzip** | 3.0 MB | 2.4초 | 0.6초 | 1분 |
| **Brotli** | 2.5 MB | 2초 | 0.5초 | 1.5분 |

**결론:**
```
Gzip이 최고의 균형!
→ 빌드 시간 OK
→ 크기 충분히 작음
→ 호환성 완벽
```

---

## 🎓 면접 대비

### 자주 나오는 질문

**Q1: "웹 압축에 대해 설명해주세요."**

**A:**
```
웹 압축은 파일 크기를 줄여 로딩 속도를 개선하는 기술입니다.
주로 Gzip과 Brotli를 사용하며, Gzip은 70%, Brotli는 75-80% 
정도 크기를 줄일 수 있습니다. 서버에서 Content-Encoding 헤더와 
함께 전송하면 브라우저가 자동으로 압축을 해제합니다.
```

---

**Q2: "Gzip과 Brotli의 차이는?"**

**A:**
```
Gzip은 1992년부터 사용된 표준으로 모든 브라우저에서 지원되며,
압축/해제가 빠릅니다. Brotli는 구글이 2015년 개발한 최신 
알고리즘으로 Gzip보다 15-20% 더 높은 압축률을 제공하지만 
압축 시간이 더 걸립니다. 일반적으로 Gzip이 무난한 선택입니다.
```

---

**Q3: "Unity WebGL에서 압축을 어떻게 설정했나요?"**

**A:**
```
Player Settings의 Publishing Settings에서 Compression Format을 
Gzip으로 설정했습니다. 이렇게 하면 .unityweb 확장자가 붙은 
압축 파일이 생성됩니다. Decompression Fallback을 활성화해서 
서버 설정이 없어도 작동하도록 했고, 실제 배포 시에는 Vercel의 
자동 압축 기능을 활용했습니다.
```

---

**Q4: "압축 외에 로딩 속도를 개선한 방법은?"**

**A:**
```
1. Code Optimization을 Size로 설정해 번들 크기 감소
2. Texture Compression으로 이미지 최적화
3. Code Stripping Level을 High로 설정해 불필요한 코드 제거
4. Data Caching 활성화로 재방문 시 빠른 로딩
이런 방식으로 전체 빌드 크기를 20MB에서 6MB로 줄였습니다.
```

---

## ✅ 핵심 요약

### 꼭 기억할 것

**1. 압축의 목적:**
```
파일 크기 감소 → 로딩 속도 향상 → 사용자 경험 개선
```

**2. 주요 알고리즘:**
```
Gzip: 표준, 70% 압축, 빠름, 모든 브라우저
Brotli: 최신, 75-80% 압축, 느림, 최신 브라우저
```

**3. Unity WebGL:**
```
Gzip 권장
→ .unityweb 확장자
→ Decompression Fallback 활성화
```

**4. 서버 설정:**
```
Content-Encoding: gzip 헤더
→ 브라우저 자동 압축 해제
→ 빠른 성능
```

**5. 개발 vs 프로덕션:**
```
개발: Disabled (빠른 빌드)
프로덕션: Gzip (작은 크기)
```

---

## 📚 더 공부하고 싶다면

### 추천 자료

**MDN:**
- [HTTP 압축](https://developer.mozilla.org/en-US/docs/Web/HTTP/Compression)
- [Content-Encoding](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding)

**Unity:**
- [WebGL Build Options](https://docs.unity3d.com/Manual/webgl-building.html)
- [Compression](https://docs.unity3d.com/Manual/webgl-deploying.html)

**알고리즘:**
- [Gzip 상세](https://www.gnu.org/software/gzip/manual/gzip.html)
- [Brotli GitHub](https://github.com/google/brotli)

---

## 🎯 다음 단계

**배운 내용 적용:**
```
1. Unity Player Settings 확인
2. Gzip 압축 활성화
3. Decompression Fallback 체크
4. 빌드 & 테스트
5. 파일 크기 비교
```

**실전 경험:**
```
Week 8: Vercel 배포 시
→ 자동 압축 설정
→ 성능 측정
→ 최적화 적용
```

---

**문서 버전:** 1.0  
**마지막 업데이트:** 2025년 12월 19일  
**소요 시간:** 약 15분  
**난이도:** ⭐⭐☆☆☆

**Happy Learning! 🚀**
